webpackJsonp([9],{"/zO5":function(e,s,a){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var t=a("0CXz"),i={name:"Cflowlist",components:{},mixins:[a("SJcF").a],data:function(){return{searchFun:t.p,AllChecked:!1,isEditMode:!1,nowCheckResult:[],shaixuanMode:!1,loading:!1}},mounted:function(){},watch:{AllChecked:function(e,s){if(this.AllChecked){var a=[];this.msgList.forEach(function(e){a.push(e._id)}),this.nowCheckResult=a}else this.nowCheckResult=[]},nowCheckResult:function(){this.AllChecked=this.nowCheckResult.length==this.msgList.length}},methods:{shaixuanRadioChanged:function(){localStorage.setItem("message.readstatus","read"==this.search.readstatus?"all":this.search.readstatus),this.searchdata(1)},initsearch:function(){var e=localStorage.getItem("message.readstatus");this.inArray(e,["unread","read","all"])||(e="unread"),this.$set(this.search,"readstatus",e)},inArray:function(e,s){return s.some(function(s){return e===s})},setReaded:function(){var e=this;this.loading=!0,0!=this.nowCheckResult.length&&Object(t.y)({msgid:this.nowCheckResult.join("-")}).then(function(s){var a=s.data;e.loading=!1,a.success?(e.$message.success(a.msg),e.flowBadge.message=e.flowBadge.message-a.data,e.msgList.forEach(function(s){e.inArray(s._id,e.nowCheckResult)&&(s.hasread=1)})):e.$message.error(a.msg),e.isEditMode=!1,e.nowCheckResult=[],e.AllChecked=!1})},gotonext:function(e){var s=this;this.isEditMode||(e.hasread||Object(t.y)({msgid:e._id}).then(function(a){a.data.success&&(e.hasread=1,s.flowBadge.message--)}),this.$router.push({name:"flowdetail",query:{msgid:e._id,flowlistid:e.flowlistid,nowfunid:e.NowFunid}}))}}},n={render:function(){var e=this,s=e.$createElement,a=e._self._c||s;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[a("div",{staticClass:"headerhandle"},[e.isEditMode?a("div",{staticClass:"pilian",on:{click:function(s){e.isEditMode=!1}}},[a("i",{staticClass:"el-icon-close"}),e._v("取消")]):a("div",{staticClass:"pilian",on:{click:function(s){e.isEditMode=!0}}},[a("i",{staticClass:"el-icon-edit"}),e._v("批量")]),e._v(" "),a("div",{staticClass:"v-search",staticStyle:{"padding-right":"46px"}},[a("van-search",{attrs:{placeholder:"搜索"},on:{search:function(s){return e.searchdata(1)},clear:function(s){return e.searchdata(1)}},model:{value:e.search.flowname,callback:function(s){e.$set(e.search,"flowname",s)},expression:"search.flowname"}})],1),e._v(" "),a("div",{staticClass:"shaixuan",on:{click:function(s){e.shaixuanMode=!e.shaixuanMode}}},[a("v-icon",{attrs:{name:"shaixuan"}}),e._v("筛选\n        ")],1)]),e._v(" "),e.shaixuanMode?a("div",{staticClass:"shaixuanBox"},[a("el-radio-group",{attrs:{size:"small"},on:{change:e.shaixuanRadioChanged},model:{value:e.search.readstatus,callback:function(s){e.$set(e.search,"readstatus",s)},expression:"search.readstatus"}},[a("el-radio-button",{attrs:{label:"all"}},[e._v("全部")]),e._v(" "),a("el-radio-button",{attrs:{label:"unread"}},[e._v("未读")]),e._v(" "),a("el-radio-button",{attrs:{label:"read"}},[e._v("已读")])],1)],1):e._e(),e._v(" "),a("van-pull-refresh",{on:{refresh:function(s){return e.searchdata(1)}},model:{value:e.pullloading,callback:function(s){e.pullloading=s},expression:"pullloading"}},[a("van-list",{attrs:{finished:this.page.finished,"finished-text":"没有更多了"},on:{load:e.listload},model:{value:e.listloading,callback:function(s){e.listloading=s},expression:"listloading"}},[a("van-checkbox-group",{model:{value:e.nowCheckResult,callback:function(s){e.nowCheckResult=s},expression:"nowCheckResult"}},e._l(e.msgList,function(s,t){return a("div",{key:t,staticClass:"msglist"},[a("div",{staticClass:"time"},[e._v(e._s(e.friendlytimejs(s.created_at)))]),e._v(" "),e.isEditMode?a("div",{staticClass:"checkbox"},[a("van-checkbox",{attrs:{name:s._id}})],1):e._e(),e._v(" "),a("div",{staticClass:"main",class:e.isEditMode?"editmode":"",on:{click:function(a){return e.gotonext(s)}}},[s.hasread?e._e():a("div",{staticClass:"hasread"}),e._v(" "),e.isEditMode?e._e():a("div",{staticClass:"arrow-right"},[a("i",{staticClass:"el-icon-arrow-right",staticStyle:{"font-size":"20px"}})]),e._v(" "),a("div",{staticClass:"headerTitle"},[100==s.level?a("span",{staticClass:"label emergency_label"},[e._v("紧急")]):e._e(),e._v("\n                            "+e._s(s.flowname)+"\n                        ")]),e._v(" "),a("div",{staticClass:"descTitle"},[e._v("\n                            描述：\n                            "),s.flowlistOi.desc?a("span",[e._v(e._s(s.flowlistOi.desc))]):a("span",[e._v("无")]),e._v(" "),a("span",{staticClass:"person"},[a("v-icon",{staticStyle:{"font-size":"12px"},attrs:{name:"person"}}),e._v(" "+e._s(s.flowlistOi.creater))],1)]),e._v(" "),a("div",{staticClass:"detail"},[a("div",[a("span",{staticClass:"label warning"},[e._v("  "+e._s(s.NowFunName))]),e._v("\n                                来自 "),a("span",{staticClass:"label success fz12"},[e._v(e._s(s.PreFunName))])])]),e._v(" "),a("div",{staticClass:"workname"},[e._v("文号:"+e._s(s.flowlistOi.workname))])])])}),0)],1)],1),e._v(" "),e.isEditMode?a("div",{staticClass:"footer"},[a("van-checkbox",{staticStyle:{display:"inline-block",margin:"6px 0 0 10px"},model:{value:e.AllChecked,callback:function(s){e.AllChecked=s},expression:"AllChecked"}},[e._v("全选")]),e._v(" "),a("el-button",{staticStyle:{float:"right","margin-left":"10px"},attrs:{size:"small"},on:{click:function(s){e.isEditMode=!1}}},[e._v("取消")]),e._v(" "),a("el-button",{staticStyle:{float:"right"},attrs:{type:"primary",disabled:!e.nowCheckResult.length,size:"small"},on:{click:e.setReaded}},[e._v("标记为已读\n            "),e.nowCheckResult.length?a("span",[e._v("\n          ("+e._s(e.nowCheckResult.length)+")\n          ")]):e._e()])],1):e._e()],1)},staticRenderFns:[]};var l=a("VU/8")(i,n,!1,function(e){a("zyPa")},"data-v-6d19461c",null);s.default=l.exports},zyPa:function(e,s){}});