(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-6e5c","chunk-2de2","chunk-5ac9"],{CgH0:function(e,t,a){"use strict";var l=a("dBFg");a.n(l).a},L1Ce:function(e,t,a){"use strict";a.r(t);var l=a("QbLZ"),n=a.n(l),s=a("Bs5o"),o=a("YCPF"),i=a("L2JU"),r={name:"Cmodaldealer",computed:n()({},Object(i.e)({flowBadge:function(e){return e.user.flowBadge}})),components:{FlowDealer:s.default,FlowDetail:o.default},data:function(){return{error:null,modalstatu:!1,title:null,successShow:!1,tabname:"flow.dealer",flowmsgid:null,flowOi_id:null,nowfunid:null,isFullScreen:!1}},watch:{},mounted:function(){},methods:{toggleFullScreen:function(){this.isFullScreen=!this.isFullScreen},revokeSuccess:function(){this.modalstatu=!1,this.flowBadge.waiting--,this.$emit("need-refresh")},dealSuccess:function(){this.flowBadge.waiting--,this.$emit("need-refresh")},cancelSuccess:function(){this.modalstatu=!1,this.flowBadge.waiting--,this.$emit("need-refresh")},cancel:function(){this.modalstatu=!1},loadmodal:function(e,t,a,l){this.flowOi_id=t,this.flowmsgid=e,this.title=a,this.modalstatu=!0,this.nowfunid=l,console.log("nowfunidmodal",l)}}},c=(a("CgH0"),a("KHd+")),u=Object(c.a)(r,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-dialog",{attrs:{width:"75%",fullscreen:!e.isPc||e.isFullScreen,"close-on-click-modal":!1,title:e.title,visible:e.modalstatu},on:{"update:visible":function(t){e.modalstatu=t}}},[e.isPc?a("span",{staticClass:"maxzoom"},[e.isFullScreen?a("svg-icon",{staticClass:"fz12",staticStyle:{color:"grey"},attrs:{"icon-class":"exit-fullscreen"},nativeOn:{click:function(t){return e.toggleFullScreen(t)}}}):a("svg-icon",{staticClass:"fz12",staticStyle:{color:"grey"},attrs:{"icon-class":"fullscreen"},nativeOn:{click:function(t){return e.toggleFullScreen(t)}}})],1):e._e(),e._v(" "),e.modalstatu?a("div",[e.successShow?e._e():a("div",[a("el-tabs",{attrs:{type:"card"},model:{value:e.tabname,callback:function(t){e.tabname=t},expression:"tabname"}},[a("el-tab-pane",{attrs:{label:"审核流程",name:"flow.dealer"}},["flow.dealer"==e.tabname?a("div",[a("flow-dealer",{attrs:{flowmsgid:e.flowmsgid},on:{"on-revoke-success":e.revokeSuccess,"on-deal-success":e.dealSuccess,"on-cancel-success":e.cancelSuccess,"update:flowmsgid":function(t){e.flowmsgid=t}}})],1):e._e()]),e._v(" "),a("el-tab-pane",{attrs:{label:"流程信息",name:"flow.detail"}},["flow.detail"==e.tabname?a("div",[a("flow-detail",{attrs:{nowfunid:e.nowfunid,"flow-oi-id":e.flowOi_id},on:{"update:nowfunid":function(t){e.nowfunid=t},"update:flowOiId":function(t){e.flowOi_id=t}}})],1):e._e()])],1)],1)]):e._e(),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"})])],1)},[],!1,null,"337a8034",null);u.options.__file="CModalFlowDealer.vue";t.default=u.exports},Lp68:function(e,t,a){"use strict";var l=a("fDSt");a.n(l).a},dBFg:function(e,t,a){},fDSt:function(e,t,a){},lvaK:function(e,t,a){"use strict";a.r(t);var l=a("YEIV"),n=a.n(l),s=a("YCPF"),o=n()({name:"Cmodaldetail",props:{isAdmin:{type:Boolean,default:function(){return!1}}},components:{FlowDetail:s.default},data:function(){return{error:null,modalstatu:!1,title:null,successShow:!1,tabname:"flow.dealer",flowmsgid:null,flowOi_id:null,nowfunid:null,isFullScreen:!1}},watch:{},mounted:function(){},methods:{}},"methods",{cancel:function(){this.modalstatu=!1},toggleFullScreen:function(){this.isFullScreen=!this.isFullScreen},loadmodal:function(e,t,a){this.flowOi_id=e,console.log("flowOi_id",e),this.title=t,this.modalstatu=!0,this.nowfunid=a}}),i=(a("Lp68"),a("KHd+")),r=Object(i.a)(o,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-dialog",{attrs:{fullscreen:!e.isPc||e.isFullScreen,title:e.title,width:"75%",visible:e.modalstatu,"close-on-click-modal":!1},on:{"update:visible":function(t){e.modalstatu=t}}},[e.isPc?a("span",{staticClass:"maxzoom"},[e.isFullScreen?a("svg-icon",{staticClass:"fz12",staticStyle:{color:"grey"},attrs:{"icon-class":"exit-fullscreen"},nativeOn:{click:function(t){return e.toggleFullScreen(t)}}}):a("svg-icon",{staticClass:"fz12",staticStyle:{color:"grey"},attrs:{"icon-class":"fullscreen"},nativeOn:{click:function(t){return e.toggleFullScreen(t)}}})],1):e._e(),e._v(" "),e.modalstatu?a("div",[a("flow-detail",{attrs:{nowfunid:e.nowfunid,"flow-oi-id":e.flowOi_id,"is-admin":e.isAdmin},on:{"update:nowfunid":function(t){e.nowfunid=t},"update:flowOiId":function(t){e.flowOi_id=t}}})],1):e._e(),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.cancel}},[e._v("取 消")])],1)])],1)},[],!1,null,"1edda0f8",null);r.options.__file="CModalFlowDetail.vue";t.default=r.exports},"q+O/":function(e,t,a){"use strict";var l=a("rzj3");a.n(l).a},rzj3:function(e,t,a){},uenu:function(e,t,a){"use strict";a.r(t);var l=a("lYLF"),n=a("wThw"),s=a("L1Ce"),o=a("lvaK"),i=a("Fnmp"),r={name:"Cflowlist",components:{ModalFlowDealer:s.default,ModalFlowDetail:o.default,FlowLog:i.default},mixins:[n.a],data:function(){return{searchFun:l.K}},activated:function(){},mounted:function(){},methods:{hasexpire:function(e){return console.log(e,new Date(e)-new Date),new Date(e)-new Date<0},dateCount:function(e){var t=new Date,a=(new Date(e)-t)/1e3/3600/24,l=Math.floor(a),n=24*(a-l),s=Math.floor(n),o=60*(n-s),i=Math.floor(o),r=60*(o-i),c=(Math.floor(r),"");return l&&(c+=Math.abs(l)+"天"),s&&(c+=s+"小时"),i&&(c+=i+"分钟"),c},initsearch:function(){this.$set(this.search,"readstatus","all")},setAllRead:function(){var e=this;Object(l.B)({type:"waiting"}).then(function(t){var a=t.data;a.success?(e.$message.success("标记成功"),e.page.result.forEach(function(e){e.hasread=1})):e.$message.error("标记失败:"+a.msg)})}}},c=(a("q+O/"),a("KHd+")),u=Object(c.a)(r,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[e.error?a("el-alert",{attrs:{title:e.error,closable:!1,type:"error"}}):a("div",[a("el-card",{staticStyle:{"margin-bottom":"20px"},attrs:{"body-style":{padding:"0px"}}},[a("div",{staticClass:"clearfix",attrs:{slot:"header","body-style":{padding:"0px"}},slot:"header"},[a("span",[a("i",{staticClass:"el-icon-search"}),e._v("\n                    搜索栏")]),e._v(" "),e.searchbarShow?a("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"},on:{click:e.toggleSearchbarShow}},[e._v("关闭")]):a("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"},on:{click:e.toggleSearchbarShow}},[e._v("展开")])],1),e._v(" "),e.searchbarShow?a("el-form",{staticClass:"searchform_oa",staticStyle:{margin:"10px"},attrs:{size:"mini","label-width":"80px"}},[a("el-form-item",{attrs:{label:"流程名称"}},[a("el-input",{model:{value:e.search.flowname,callback:function(t){e.$set(e.search,"flowname",t)},expression:"search.flowname"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"文号"}},[a("el-input",{model:{value:e.search.workname,callback:function(t){e.$set(e.search,"workname",t)},expression:"search.workname"}})],1),e._v(" "),e.search.readstatus?a("el-form-item",{attrs:{label:"是否已读"}},[a("el-radio-group",{model:{value:e.search.readstatus,callback:function(t){e.$set(e.search,"readstatus",t)},expression:"search.readstatus"}},[a("el-radio",{attrs:{label:"read"}},[e._v("已读")]),e._v(" "),a("el-radio",{attrs:{label:"unread"}},[e._v("未读")]),e._v(" "),a("el-radio",{attrs:{label:"all"}},[e._v("全部")])],1)],1):e._e(),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.searchSummit}},[e._v("搜索")])],1)],1):e._e()],1),e._v(" "),a("el-card",[e.searchloading?a("div",{staticClass:"box  pd10 mg10 text-center"},[e._v("\n                正在加载中。。。\n            ")]):e._e(),e._v(" "),0!=e.page.result.length||e.searchloading?e._e():a("div",{staticClass:"box pd10 mg10 text-center"},[e._v("无任何记录")]),e._v(" "),0!=e.page.result.length?a("div",{staticClass:"box"},[a("div",[e._v("共搜索到\n                    "),a("span",[e._v(e._s(e.page.totalItems))]),e._v(" 条信息\n\n                    "),a("div",{staticStyle:{float:"right"}},[a("el-button",{attrs:{type:"primary"},on:{click:e.setAllRead}},[e._v("全部标记已读")])],1)]),e._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.page.result,stripe:"","row-class-name":e.tableRowClassName}},[a("el-table-column",{attrs:{label:"流程名称",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("strong",[e._v(e._s(t.row.flowname))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"文号",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){var l=t.row;return[100==l.level?a("span",{staticClass:"emergency_label"},[e._v("紧急")]):e._e(),e._v("\n                            "+e._s(l.flowlistOi.workname)+"\n                        ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"流程描述",width:"230"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v("\n                            "+e._s(a.flowlistOi.desc)+"\n                        ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"处理节点",width:"220"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticClass:"label warning"},[e._v("\n                                "+e._s(t.row.NowFunName)+"\n                            ")]),e._v("\n                            来自\n\n                            "),a("span",{staticClass:"label success fz12"},[e._v(e._s(t.row.PreFunName))]),e._v(" "),a("v-icon",{staticStyle:{cursor:"pointer","margin-left":"5px"},attrs:{name:"ios-git-network"},on:{click:e.showflowgraph}})]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"超时",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){var l=t.row;return[l.timeexpired?a("span",[a("el-tooltip",{staticClass:"item",attrs:{content:"过期时间："+l.timeexpired,effect:"dark",placement:"top-start"}},[a("span",[e.hasexpire(l.timeexpired)?a("span",{staticStyle:{color:"red"}},[e._v("\n                                            [已超时]"+e._s(e.dateCount(l.timeexpired))+"\n                                        ")]):a("span",[e._v("\n                                            剩余\n                                            "+e._s(e.dateCount(l.timeexpired))+"\n                                        ")])])])],1):a("span",[e._v("\n                                无\n                            ")]),e._v(" "),l.expiredtimes?a("span",{staticClass:"expiredtimes",attrs:{title:"超时次数"}},[e._v(e._s(l.expiredtimes))]):e._e()]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"状态",width:"90"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[e._v("\n                            "+e._s(a.hasread?"已读":"未读")+"\n                        ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"流程创建时间",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[e._v(" 创建于 "+e._s(e.friendlytimejs(t.row.flowlistOi.created_at))+"\n                                "),a("span",{staticClass:"person"},[e._v(" "+e._s(t.row.flowlistOi.creater))])]),e._v(" "),a("div",{staticClass:"mg-t5"},[e._v("转到此处："+e._s(e.friendlytimejs(t.row.created_at))+"\n                                "),a("span",{staticClass:"person"},[e._v(" "+e._s(t.row.creater))])])]}}])}),e._v(" "),a("el-table-column",{attrs:{fixed:"right",label:"操作",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){var l=t.row;return[a("el-button",{staticStyle:{"margin-right":"5px"},attrs:{type:"primary",size:"small"},on:{click:function(t){e.dealflow(l)}}},[e._v("处理")]),e._v(" "),a("el-button",{attrs:{type:"error",size:"small"},on:{click:function(t){e.seedetail_and_set_read(l,"waiting")}}},[e._v("查看流程")])]}}])})],1),e._v(" "),a("el-pagination",{attrs:{"current-page":e.page.currentPage,"page-size":e.page.pageSize,total:e.page.totalItems,background:"",layout:"prev, pager, next"},on:{"current-change":e.handerPageChange}})],1):e._e()])],1),e._v(" "),e.candeal?a("modal-flow-dealer",{ref:"flowdealer",on:{"need-refresh":function(t){e.searchdata(1)}}}):e._e(),e._v(" "),a("modal-flow-detail",{ref:"flowdetail"})],1)},[],!1,null,"013add2e",null);u.options.__file="CFlowListWaiting.vue";t.default=u.exports},wThw:function(e,t,a){"use strict";var l=a("QbLZ"),n=a.n(l),s=a("L2JU"),o=a("k48p"),i=a("lYLF");t.a={name:"flowlist",computed:n()({},Object(s.e)({flowBadge:function(e){return e.user.flowBadge}})),components:{},data:function(){return{candeal:!1,searchFun:null,error:null,columns:[{title:"流程名称",slot:"flowdesignername"},{title:"流程描述",slot:"flow_desc"},{title:"流程创建时间",slot:"flow_created_at"},{title:"处理节点",slot:"flowstatusat"},{title:"可操作",slot:"action",width:150,align:"center"}],searchbarShow:!1,searchloading:!1,search_list:null,orderby_list:null,display_list:null,search:{s_isorder:null,s_orderby:null},page:{result:[],totalItems:0,pageSize:20,currentPage:1}}},methods:{tableRowClassName:function(e){var t=e.row;return t.level&&100==t.level?"emergency_row":""},initsearch:function(){},searchSummit:function(){this.searchdata(1)},friendlytimejs:function(e){return Object(o.a)(e,new Date)},seedetail:function(e){this.$refs.flowdetail.loadmodal(e.flowlistid,"查看 "+e.flowname+" 明细",e.NowFunid)},seedetail_and_set_read:function(e,t){var a=this;e.hasread||Object(i.C)({msgid:e._id}).then(function(l){l.data.success&&(e.hasread=1,"message"==t&&a.flowBadge.message--,"cc"==t&&a.flowBadge.cc--)}),this.seedetail(e)},dealflow:function(e){var t=this;console.log("mesObj",e),this.candeal=!1,setTimeout(function(){t.candeal=!0,setTimeout(function(){t.$refs.flowdealer.loadmodal(e._id,e.flowlistid,"审批"+e.flowname+"<"+e.NowFunName+">",e.NowFunid)},100)},100),e.hasread=1},handerPageChange:function(e){this.searchdata(e)},showflowgraph:function(){this.$message.info("此处后期显示流程图")},getflowfunByfunid:function(e,t){for(var a=0;a<e.funlist.length;a++){var l=e.funlist[a];if(l.id==t)return l}return null},initresultdata:function(){console.log(this.page)},searchdata:function(e){var t=this;this.searchloading?this.$message.warning("请勿重复提交表单"):(this.searchloading=!0,this.page.result=[],this.searchFun({nowpage:e,search:this.search}).then(function(e){var a=e.data;console.log(a),t.AfterSearch(a),t.searchloading=!1}).catch(function(e){t.searchloading=!1}))},AfterSearch:function(e){this.page=e.data,this.initresultdata()},toggleSearchbarShow:function(){this.searchbarShow=!this.searchbarShow,this.searchbarShow?window.localStorage.setItem("searchbarShow",1):window.localStorage.removeItem("searchbarShow")}},activated:function(){},mounted:function(){this.initsearch(),this.searchdata(1),this.searchbarShow=!!window.localStorage.getItem("searchbarShow")}}}}]);